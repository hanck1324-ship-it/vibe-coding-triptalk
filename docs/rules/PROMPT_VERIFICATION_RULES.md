# AI 작업 지시 시 "구현 후 동작 검증" 누락 방지 프롬프트 가이드

## 📌 문제 상황

**발생한 문제:**
- 로그인 기능, 게시글 좋아요, 여행 상품 삭제 등의 기능을 구현했으나
- **실제 로그인 후 프로필이 표시되는지** 등 전체 플로우 동작 검증을 하지 않음
- 코드만 작성하고 끝내서, 연관된 컴포넌트 간 통합 문제를 놓침

**근본 원인:**
- AI에게 "구현만" 요청하고, "검증"까지 요청하지 않음
- 연관된 컴포넌트들(예: 로그인 → 네비게이션)의 통합 테스트 누락
- 구현 후 실제 사용자 시나리오 테스트 누락

---

## ✅ 해결 방안: 프롬프트 작성 시 필수 포함 항목

### 1. 기존 프롬프트 구조 (변경 없음)

프로젝트의 기존 프롬프트 체계는 유지:

```
prompt.01.wireframe.txt    - HTML 구조
prompt.201.ui.txt          - 스타일
prompt.301.func.txt        - 기능 구현
```

### 2. 새로운 섹션 추가: "조건-검증"

**모든 기능 프롬프트(301, 401, 501)에 필수 추가:**

```
==============================================

조건-검증) 구현 완료 후 다음 항목들을 검증하고, 검증 결과를 체크리스트로 반환할 것.

        1) 연관 컴포넌트 확인
            - 이 기능이 영향을 주는 다른 컴포넌트들을 나열
            - 각 컴포넌트가 올바르게 업데이트되는지 확인

        2) 전체 플로우 테스트 시나리오
            - 사용자 관점에서 시작부터 끝까지의 동작 흐름 작성
            - 각 단계별 예상 결과 명시

        3) 상태 동기화 확인
            - localStorage와 React 상태가 동기화되는지 확인
            - GraphQL 쿼리가 적절한 시점에 실행되는지 확인
            - useEffect 의존성 배열이 올바른지 확인

        4) 에러 시나리오
            - 네트워크 실패 시 동작
            - 토큰 만료 시 동작
            - 잘못된 입력값 처리
```

---

## 📝 구체적 예시

### 예시 1: 로그인 기능 프롬프트

#### ❌ 기존 방식 (문제 있음)

```
핵심요구사항) 로그인 기능을 구현할 것.

        1) GraphQL 쿼리 구현
            - loginUser mutation 구현
            - 토큰 저장

        2) UI 연동
            - 로그인 성공 시 홈으로 이동
```

#### ✅ 개선된 방식 (검증 포함)

```
핵심요구사항) 로그인 기능을 구현할 것.

        1) GraphQL 쿼리 구현
            - loginUser mutation 구현
            - 토큰을 localStorage에 저장
            - localStorageChange 커스텀 이벤트 발생

        2) UI 연동
            - 로그인 성공 시 홈으로 이동

==============================================

조건-검증) 구현 완료 후 다음 항목들을 검증하고, 검증 결과를 체크리스트로 반환할 것.

        1) 연관 컴포넌트 확인
            - src/commons/layout/navigation/hook.ts
              → 로그인 후 isLoggedIn 상태가 true로 변경되는지
              → 사용자 정보(user)가 조회되는지
              → 프로필 이미지와 이름이 표시되는지

        2) 전체 플로우 테스트 시나리오
            Step 1: 로그인 페이지에서 이메일/비밀번호 입력
            Step 2: 로그인 버튼 클릭
            Step 3: localStorage에 accessToken 저장 확인
            Step 4: 홈 페이지로 이동
            Step 5: 네비게이션 바에 프로필 아이콘 표시 확인
            Step 6: 프로필 클릭 시 드롭다운 메뉴 표시 확인
            Step 7: 사용자 이름과 포인트 정보 표시 확인

        3) 상태 동기화 확인
            - localStorage.setItem 직후 localStorageChange 이벤트 발생 확인
            - Navigation 컴포넌트의 useEffect가 이벤트를 감지하는지 확인
            - FETCH_USER_LOGGED_IN 쿼리가 skip: false로 실행되는지 확인
            - refetch()가 호출되어 사용자 정보를 가져오는지 확인

        4) 에러 시나리오
            - 잘못된 비밀번호 입력 시 에러 메시지 표시
            - 네트워크 에러 시 적절한 메시지 표시
            - 토큰이 없을 때 프로필 대신 로그인 버튼 표시
```

---

### 예시 2: 게시글 좋아요 기능 프롬프트

```
핵심요구사항) 게시글 좋아요 기능을 구현할 것.

        1) GraphQL 쿼리 구현
            - likeBoard mutation 구현
            - Optimistic UI 적용

        2) 캐시 업데이트
            - Apollo Client 캐시 직접 업데이트

==============================================

조건-검증) 구현 완료 후 다음 항목들을 검증하고, 검증 결과를 체크리스트로 반환할 것.

        1) 연관 컴포넌트 확인
            - src/components/boards-detail/detail/index.tsx
              → 좋아요 버튼 클릭 가능 확인
              → likeCount 숫자가 즉시 증가하는지 확인 (Optimistic UI)

        2) 전체 플로우 테스트 시나리오
            Step 1: 게시글 상세 페이지 접속
            Step 2: 현재 좋아요 수 확인 (예: 5)
            Step 3: 좋아요 아이콘 클릭
            Step 4: 즉시 숫자 증가 확인 (5 → 6, Optimistic UI)
            Step 5: 서버 응답 후에도 숫자 유지 확인
            Step 6: 페이지 새로고침 후에도 증가된 숫자 유지 확인

        3) 상태 동기화 확인
            - Optimistic UI가 즉시 반영되는지 확인
            - cache.writeQuery로 Apollo 캐시가 업데이트되는지 확인
            - 서버 응답 실패 시 원래 값으로 롤백되는지 확인

        4) 에러 시나리오
            - 로그인하지 않은 상태에서 클릭 시 처리
            - 네트워크 에러 시 alert 표시 및 롤백
            - 이미 좋아요를 누른 경우 처리 (있다면)
```

---

### 예시 3: 여행 상품 삭제 기능 프롬프트

```
핵심요구사항) 여행 상품 삭제 기능을 구현할 것.

        1) GraphQL 쿼리 구현
            - deleteTravelproduct mutation 구현

        2) 캐시 업데이트
            - FETCH_TRAVELPRODUCTS 목록에서 삭제된 상품 제거
            - cache.evict로 상세 페이지 캐시 제거

==============================================

조건-검증) 구현 완료 후 다음 항목들을 검증하고, 검증 결과를 체크리스트로 반환할 것.

        1) 연관 컴포넌트 확인
            - src/components/purchase/detail/index.tsx
              → 판매자일 때만 삭제 버튼 표시 확인
            - src/components/purchase/list/index.tsx
              → 삭제 후 목록에서 해당 상품 제거 확인

        2) 전체 플로우 테스트 시나리오
            Step 1: 자신이 등록한 상품 상세 페이지 접속
            Step 2: 삭제 버튼이 표시되는지 확인
            Step 3: 삭제 버튼 클릭
            Step 4: 확인 모달 표시 확인
            Step 5: 확인 클릭
            Step 6: "삭제되었습니다" alert 표시 확인
            Step 7: 상품 목록 페이지로 이동 확인
            Step 8: 목록에서 해당 상품이 사라졌는지 확인

        3) 상태 동기화 확인
            - cache.writeQuery로 목록에서 제거되는지 확인
            - cache.evict로 상세 페이지 캐시가 제거되는지 확인
            - 다른 사용자가 등록한 상품에는 삭제 버튼이 없는지 확인

        4) 에러 시나리오
            - 권한이 없는 상품 삭제 시도 시 에러 메시지
            - 이미 삭제된 상품 접근 시 처리
            - 네트워크 에러 시 alert 표시
```

---

## ✓ 프롬프트 작성 시 체크리스트

### 기능 프롬프트(301, 401, 501) 작성 후 필수 확인:

```
[ ] "조건-검증" 섹션이 포함되어 있는가?
[ ] 연관 컴포넌트를 모두 나열했는가?
[ ] 전체 플로우를 Step-by-Step으로 작성했는가?
[ ] 상태 동기화 확인 항목이 있는가?
    [ ] localStorage ↔ React 상태
    [ ] GraphQL 캐시 업데이트
    [ ] useEffect 의존성 배열
[ ] 에러 시나리오를 3개 이상 작성했는가?
[ ] 각 검증 항목에 "확인" 동사가 포함되어 있는가?
```

---

## 🚀 적용 방법

### 1단계: 기존 프롬프트 템플릿 수정

기존 템플릿에 "조건-검증" 섹션 추가:

```
조건-커서룰) ...
조건-파일경로) ...
조건-피그마) ...      (선택사항)

조건-검증) 구현 완료 후 다음 항목들을 검증하고, 검증 결과를 체크리스트로 반환할 것.
        1) 연관 컴포넌트 확인
        2) 전체 플로우 테스트 시나리오
        3) 상태 동기화 확인
        4) 에러 시나리오

핵심요구사항) ...
```

### 2단계: 새 프롬프트 작성 시 적용

- Wireframe 프롬프트: "조건-검증" 불필요
- UI 프롬프트: "조건-검증" 불필요
- **기능 프롬프트**: "조건-검증" **필수**

### 3단계: AI에게 명확히 지시

프롬프트 실행 시:
```
이 프롬프트를 실행하고, 마지막에 "조건-검증" 섹션의
모든 항목을 체크리스트 형태로 반환해줘.
```

---

## 📊 예상 효과

### Before (기존 방식):
```
✅ 로그인 기능 구현 완료
✅ 토큰 저장 완료
✅ 홈으로 이동 완료

→ 하지만 프로필이 안 나타남 (검증 안 함)
```

### After (개선된 방식):
```
✅ 로그인 기능 구현 완료
✅ 토큰 저장 완료
✅ 홈으로 이동 완료

검증 결과:
✅ localStorage에 accessToken 저장됨
✅ localStorageChange 이벤트 발생 확인
✅ Navigation의 isLoggedIn이 true로 변경됨
✅ FETCH_USER_LOGGED_IN 쿼리 실행 확인
✅ 프로필 이미지 표시됨
✅ 사용자 이름 표시됨
✅ 드롭다운 메뉴 동작 확인
✅ 포인트 정보 표시됨

→ 전체 플로우 동작 확인 완료!
```

---

## ⚠️ 주의사항

### 1. 과도한 검증 지양
- 간단한 기능은 2-3개 항목만 검증
- 복잡한 통합 기능만 상세 검증

### 2. 검증 항목의 구체성
- ❌ "잘 동작하는지 확인"
- ✅ "프로필 이미지가 표시되는지 확인"

### 3. 연관 컴포넌트 누락 방지
- 구현 전 영향 받는 파일 모두 나열
- 예: 로그인 → Navigation, MyPage, Protected Routes

### 4. 실제 사용자 시나리오 기반
- 개발자 관점이 아닌 사용자 관점
- ❌ "API 호출 성공"
- ✅ "로그인 후 프로필 표시"

---

## 📋 템플릿

### 기능 프롬프트 기본 템플릿

```
아래의 조건을 모두 적용하여, 아래의 요구사항을 모두 구현할 것.
구현 결과를 체크리스트로 반환할 것.

==============================================

조건-커서룰) 아래의 커서룰을 적용하여 작업하고, 이 작업이 끝나면 해당 rules 적용 결과를 체크리스트로 반환할 것.
            - @01-common.mdc
            - @04-func.mdc

==============================================

조건-파일경로) 구현될 HOOK 파일경로: src/components/[컴포넌트]/hook.ts
조건-파일경로) 구현될 GQL 파일경로: src/components/[컴포넌트]/queries.ts
조건-파일경로) (참고) 공통 GQL 타입: src/commons/graphql/graphql.ts

==============================================

조건-검증) 구현 완료 후 다음 항목들을 검증하고, 검증 결과를 체크리스트로 반환할 것.

        1) 연관 컴포넌트 확인
            - [파일경로1]
              → [확인할 동작1]
              → [확인할 동작2]
            - [파일경로2]
              → [확인할 동작3]

        2) 전체 플로우 테스트 시나리오
            Step 1: [사용자 동작]
            Step 2: [예상 결과]
            Step 3: [사용자 동작]
            Step 4: [예상 결과]
            ...

        3) 상태 동기화 확인
            - [동기화 항목1] 확인
            - [동기화 항목2] 확인
            - useEffect 의존성 배열이 올바른지 확인

        4) 에러 시나리오
            - [에러 상황1] 시 [처리 방법]
            - [에러 상황2] 시 [처리 방법]
            - [에러 상황3] 시 [처리 방법]

==============================================

핵심요구사항) [기능명]을 step-by-step 으로 구현하고, 적용 결과를 체크리스트로 반환할 것.

        1) [카테고리1]
            - [요구사항1]
            - [요구사항2]

        2) [카테고리2]
            - [요구사항3]
            - [요구사항4]
```

---

## 🎯 결론

### 핵심 원칙:
1. 기능 프롬프트에는 반드시 "조건-검증" 섹션 포함
2. 연관 컴포넌트를 모두 나열하고 동작 확인
3. 사용자 시나리오 기반으로 전체 플로우 검증
4. 상태 동기화와 에러 처리 필수 확인

### 기대 효과:
- 구현 후 통합 문제 사전 발견
- 연관 컴포넌트 누락 방지
- 실제 동작 검증을 통한 품질 향상
- AI와의 협업 효율성 증가

**이 가이드를 따르면 "로그인은 되는데 프로필이 안 나타나는" 같은 통합 문제를 사전에 방지할 수 있습니다.**
